title: 函数式编程
date: 2016-07-11 18:22:28
tags: Functional Programming
categories: Others
---

## 写在前面

本文是笔者了解**函数式编程**（functional programming）过程中的学习笔记，大范围参考（拷贝）阮一峰的[函数式编程初探](http://www.ruanyifeng.com/blog/2012/04/functional_programming.html)。

## 定义

简单来说，**函数式编程**是一种编程范式（programming paradigm），也就是如何编程程序的方法论。

>**P.S:** 除了函数式编程，常见的编程范式还包括**命令式编程**（imperative programming）、逻辑式编程，常见的面向对象就是一种命令式编程。

函数式编程的住哟啊思想是把运算过程尽量写成一系列嵌套的函数调用。具体来说，现在有这样一个数学表达式：

```
(1 + 2) * 3 - 4
```

传统的命令式编程，可能这样写：

```swift
let a = 1 + 2
let b = a * 3
let c = b - 4
```

函数式编程要求使用函数，我们可以把运算过程定义为不同的函数，然后写成下面这样：

```swift
let result = subtract(multiply(add(1, 2), 3), 4)
```

这就是函数式编程。

## 特点

函数式编程有5个鲜明的特点。

**1. 函数是第一等公民**

所谓第一等公民（first class），指的是函数和其他数据类型一样，可以赋值给其他变量，也可以作为别的函数的参数传入，或者作为返回值返回。

如下示例是为Swift中的`Int`类型定义一个扩展方法`times`：

```swift
extension Int {
  func times(n: Int, _ f: Int -> Void) {
    for _ in 0..<n {
      f(self)
    }
  }
}

3.times(2) { i in
  print(i)
}

// 输出结果:
// 3
// 3
```

**2. 只用表达式，不用语句**

表达式（expression）是一个单纯的运算过程，总有返回值；语句（statement）是执行某种操作，没有返回值。函数式编程要求，只使用表达式，不使用语句。也就是说，每一步都是单纯的运算，而且都有返回值。

原因是函数式编程的开发动机，一开始就是为了处理运算（computation），不考虑系统的读写（I/O）。语句属于对系统的读写操作，所以就被排斥在外。

当然，实际应用中，不做I/O是不可能的。因此，编程过程中，函数式编程只要求把I/O限制到最小，不要有不必要的读写行为，保持计算过程的单纯性。

**3. 没有副作用**

副作用（side effect），指的是函数内部与外部互动（最典型的情况，就是修改全局变量的值），产生运算以外的其他结果。

函数式编程强调没有副作用，意味着函数要保持独立，所有功能就是返回一个新的值，没有其他行为，尤其是不得修改外部变量的值。

这意味着函数里所用到的资源都是局部变量或者传入的参数？传入的参数不可以是引用类型？

**4. 不修改状态**

上一点已经提到，函数式编程只是返回新的值，不修改系统变量。因此，不修改变量，也是它的一个重要特点。

P.S: 这里所说的「不修改变量」中的「变量」是什么样的变量？

在其他类型的语言中，变量往往用来保存状态（state）。不修改变量，意味着状态不能保存在变量中。函数式编程使用参数保存状态，最好的例子就是递归。下面的代码是一个将字符串逆序排列的函数，它演示了不同的参数如何决定了运算所处的状态。

```swift
func reverse(string: String) -> String {
  if string.isEmpty {
    return string
  } else {
    let index = string.startIndex.advancedBy(1)
    return reverse(string.substringFromIndex(index)) + string.substringToIndex(index)
  }
}
```

P.S: 对于这个特点，不太理解！

**5. 引用透明**

引用透明（referential transparency），指的是函数的运行不依赖于外部变量或状态，只依赖于输入的参数，任何是偶只要参数相同，引用函数（即调用函数）所得到的返回值总是相同的。

P.S: 这几个特点适用于实例方法吗？

## 意义

函数式编程到底有什么好处，为什么会变得越来越流行？

**1. 代码简洁，开发快速**

函数式编程大量使用函数，减少了代码的重复，因此程序比较短，开发速度快。

Paul Graham在[《黑客与画家》](http://www.ruanyifeng.com/docs/pg/)一书中写道：同样功能的程序，极端情况下，Lisp（函数式语言）代码的长度可能是C代码的二十分之一。

**2. 接近自然语言，易于理解**

函数式编程的自由度很高，可以写出很接近自然语言的代码。

前文曾经将表达式`(1 + 2) * 3 - 4`，写出了函数式语言：

```swift
subtract(multiply(add(1, 2), 3), 4)
```

对它进行变形，不难得到另一种写法：

```swift
add(1, 2).multiply(3).subtract(4)
```

这基本就是自然语言的表达了，函数式编程的代码更容易理解。

**3. 更方便的代码管理**

函数式编程不依赖、也不会改版外界的状态，只要给定输入参数，返回的结果必定相同。因此，每一个函数都可以被看做独立单元，很有利于进行单元测试（unit testing）和除错（debugging），以及模块化组合。

**4. 易于并发编程**

函数式编程不需要考虑死锁（deadlock），因为它不需要修改变量，所以根本不存在**锁**线程问题。不必担心一个线程的数据被另一个线程修改，所以可以很放心地把工作分摊到多个线程，部署并发（concurrency）编程。

**5. 代码的热升级**

函数式编程没有副作用，只要保证接口不变，内部实现是外部无关的。所以，可以在运行状态下直接升级代码，不需要重启，也不需要停机。[Erlang](https://en.wikipedia.org/wiki/Erlang_(programming_language))语言早就证明了这一点，它是瑞典爱立信公司为了管理电话系统而开发的，电话系统的升级当然是不能停机的。

## 写在后面

掌握函数式编程思维，最好的途径是什么？学习Haskell？

对于iOS开发而言，函数式编程有哪些应用场景？

## 本文参考

* [函数式编程初探](http://www.ruanyifeng.com/blog/2012/04/functional_programming.html)
* [什么是函数式编程思维](https://www.zhihu.com/question/28292740/answer/40336090)

